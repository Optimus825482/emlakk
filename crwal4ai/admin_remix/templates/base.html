<!doctype html>
<html
  lang="tr"
  x-data
  :class="{ 'dark': $store.app.darkMode }"
  class="antialiased selection:bg-emerald-500/30 selection:text-emerald-200"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Admin Paneli{% endblock %} - Sahibinden Tarayıcı</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              border: "hsl(var(--border))",
              input: "hsl(var(--input))",
              ring: "hsl(var(--ring))",
              background: "hsl(var(--background))",
              foreground: "hsl(var(--foreground))",
              primary: {
                DEFAULT: "#10b981",
                foreground: "#ffffff",
                50: "#ecfdf5",
                100: "#d1fae5",
                200: "#a7f3d0",
                300: "#6ee7b7",
                400: "#34d399",
                500: "#10b981",
                600: "#059669",
                700: "#047857",
                800: "#065f46",
                900: "#064e3b",
              },
              brand: {
                black: "#0a0a0a",
                gray: "#1a1a1a",
                accent: "#d9ff00",
              }
            },
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              display: ["Outfit", "sans-serif"],
            },
          },
        },
      }
    </script>

    <!-- Alpine.js -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      [x-cloak] { display: none !important; }
      
      :root {
        --background: 0 0% 100%;
        --foreground: 240 10% 3.9%;
        --border: 240 5.9% 90%;
      }
      
      .dark {
        --background: 240 10% 3.9%;
        --foreground: 0 0% 98%;
        --border: 240 3.7% 15.9%;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: rgb(249 250 251);
      }
      .dark body {
        background-color: #050505;
      }

      h1, h2, h3, h4, h5, h6, .font-display {
        font-family: "Outfit", sans-serif;
        letter-spacing: -0.02em;
      }

      /* Modern Scrollbar */
      ::-webkit-scrollbar { width: 5px; height: 5px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { 
        background: #e5e7eb; 
        border-radius: 0px; 
      }
      .dark ::-webkit-scrollbar-thumb { background: #262626; }
      ::-webkit-scrollbar-thumb:hover { background: #d1d5db; }

      /* Technical Aesthetics */
      .glass-panel {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(0, 0, 0, 0.1);
      }
      .dark .glass-panel {
        background: rgba(10, 10, 10, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      
      .nav-item-active {
        @apply bg-brand-accent/10 text-brand-accent border-r-2 border-brand-accent;
      }

      /* Loading Bar Animation */
      @keyframes loading-bar {
        0% { left: -40%; width: 40%; }
        100% { left: 100%; width: 40%; }
      }
      .animate-loading {
        animation: loading-bar 1.5s infinite linear;
      }
    </style>
    
    {% block head %}{% endblock %}
  </head>
  <body class="text-slate-900 dark:text-slate-100 min-h-screen">

    <script>
      document.addEventListener('alpine:init', () => {
        Alpine.store('app', {
          sidebarOpen: localStorage.getItem('sidebarOpen') !== 'false',
          darkMode: localStorage.getItem('darkMode') === 'true',
          mobileOpen: false,
          globalLoading: false,
          toasts: [],
          
          toggleSidebar() {
            this.sidebarOpen = !this.sidebarOpen;
            localStorage.setItem('sidebarOpen', this.sidebarOpen);
          },
          
          toggleDarkMode() {
            this.darkMode = !this.darkMode;
            localStorage.setItem('darkMode', this.darkMode);
          },
          
          setLoading(status) {
            this.globalLoading = status;
          },
          
          toast(message, type = 'info') {
            const id = Date.now();
            this.toasts.push({ id, message, type });
            setTimeout(() => this.removeToast(id), 5000);
          },
          
          removeToast(id) {
            this.toasts = this.toasts.filter(t => t.id !== id);
          }
        });
      });
      
      // Initialize Lucide icons after Alpine
      document.addEventListener('alpine:initialized', () => {
        lucide.createIcons();
      });
    </script>

    <div 
      x-show="$store.app.globalLoading" 
      x-cloak
      class="fixed top-0 left-0 right-0 h-1 z-[100] bg-brand-accent/20 overflow-hidden"
    >
      <div class="absolute top-0 bottom-0 bg-brand-accent animate-loading"></div>
    </div>

    <div class="fixed bottom-6 right-6 z-[90] flex flex-col gap-3 pointer-events-none">
      <template x-for="t in $store.app.toasts" :key="t.id">
        <div 
          x-transition:enter="transition ease-out duration-300 transform"
          x-transition:enter-start="translate-y-4 opacity-0 scale-95"
          x-transition:enter-end="translate-y-0 opacity-100 scale-100"
          x-transition:leave="transition ease-in duration-200"
          x-transition:leave-start="opacity-100 scale-100"
          x-transition:leave-end="opacity-0 scale-95"
          class="pointer-events-auto min-w-[320px] p-4 bg-white dark:bg-brand-gray border border-slate-200 dark:border-white/10 shadow-2xl flex items-center gap-4"
          :class="{
            'border-l-4 border-l-emerald-500': t.type === 'success',
            'border-l-4 border-l-rose-500': t.type === 'error',
            'border-l-4 border-l-amber-500': t.type === 'warning',
            'border-l-4 border-l-blue-500': t.type === 'info',
          }"
        >
          <div class="flex-1">
            <p class="text-sm font-medium" x-text="t.message"></p>
          </div>
          <button @click="$store.app.removeToast(t.id)" class="text-slate-400 hover:text-slate-600 dark:hover:text-white transition">
            <i data-lucide="x" class="w-4 h-4"></i>
          </button>
        </div>
      </template>
    </div>

    <div class="flex h-screen overflow-hidden">
      <aside 
        class="hidden lg:flex flex-col bg-white dark:bg-brand-black border-r border-slate-200 dark:border-white/5 transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]"
        :class="$store.app.sidebarOpen ? 'w-[280px]' : 'w-[80px]'"
      >
        <div class="h-20 flex items-center px-6 border-b border-slate-100 dark:border-white/5 overflow-hidden">
          <div class="flex items-center gap-4 min-w-max">
            <div class="w-10 h-10 bg-brand-accent flex items-center justify-center rounded-none transform rotate-3 hover:rotate-0 transition-transform duration-500 shadow-lg shadow-brand-accent/20">
              <i data-lucide="building-2" class="w-6 h-6 text-brand-black"></i>
            </div>
            <div x-show="$store.app.sidebarOpen" x-transition.opacity.duration.500 class="flex flex-col">
              <span class="font-display font-extrabold text-xl tracking-tighter leading-none">DEMIR</span>
              <span class="text-[10px] font-bold text-emerald-500 tracking-[0.2em] uppercase">TARAYICI SİSTEMİ</span>
            </div>
          </div>
        </div>

        <nav class="flex-1 px-3 py-6 space-y-2 overflow-y-auto">
          {% set nav_items = [
            {'path': '/', 'label': 'Gösterge Paneli', 'icon': 'layout-dashboard'},
            {'path': '/crawler', 'label': 'Tarayıcı Kontrolü', 'icon': 'cpu'},
            {'path': '/listings', 'label': 'Aktif İlanlar', 'icon': 'clipboard-list'},
            {'path': '/new-listings', 'label': 'Yeni Eklenenler', 'icon': 'sparkles', 'badge': 'YENİ'},
            {'path': '/removed-listings', 'label': 'Arşivlenenler', 'icon': 'archive'},
            {'path': '/stats', 'label': 'Analizler', 'icon': 'bar-chart-3'},
            {'path': '/map', 'label': 'Harita', 'icon': 'map', 'badge': 'SICAK'},
            {'path': '/sahibinden_check', 'label': 'Canlı Denetçi', 'icon': 'search-code'}
          ] %}

          {% for item in nav_items %}
          <a 
            href="{{ item.path }}"
            class="group flex items-center gap-4 px-4 py-3 border border-transparent transition-all duration-300 hover:border-slate-200 dark:hover:border-white/10 hover:bg-slate-50 dark:hover:bg-white/5 {% if request.path == item.path %} bg-brand-accent/5 !border-brand-accent/50 text-brand-accent {% else %} text-slate-500 dark:text-slate-400 {% endif %}"
          >
            <i data-lucide="{{ item.icon }}" class="w-5 h-5 flex-shrink-0 transition-transform group-hover:scale-110"></i>
            <span x-show="$store.app.sidebarOpen" x-transition.opacity class="font-medium text-sm whitespace-nowrap">{{ item.label }}</span>
            {% if item.badge and '$store.app.sidebarOpen' %}
              <span x-show="$store.app.sidebarOpen" class="ml-auto text-[8px] font-black bg-brand-accent text-brand-black px-1 py-0.5">{{ item.badge }}</span>
            {% endif %}
          </a>
          {% endfor %}
        </nav>

        <div class="p-4 border-t border-slate-100 dark:border-white/5 bg-slate-50/50 dark:bg-white/[0.02]">
          <button 
            @click="$store.app.toggleDarkMode()"
            class="w-full flex items-center gap-4 px-4 py-3 text-slate-500 dark:text-slate-400 hover:text-brand-accent transition-colors"
          >
            <i :data-lucide="$store.app.darkMode ? 'sun' : 'moon'" class="w-5 h-5"></i>
            <span x-show="$store.app.sidebarOpen" x-text="$store.app.darkMode ? 'Açık Tema' : 'Koyu Tema'" class="text-sm font-medium"></span>
          </button>
        </div>
      </aside>

      <div class="flex-1 flex flex-col relative bg-slate-50/50 dark:bg-transparent overflow-hidden">
        
        <header class="h-20 flex items-center justify-between px-6 lg:px-10 border-b border-slate-200 dark:border-white/5 bg-white/80 dark:bg-brand-black/80 backdrop-blur-md z-30">
          <div class="flex items-center gap-6">
            <button @click="$store.app.toggleSidebar()" class="hidden lg:flex p-2 text-slate-400 hover:text-brand-accent transition">
              <i :data-lucide="$store.app.sidebarOpen ? 'indent-decrease' : 'indent-increase'" class="w-6 h-6"></i>
            </button>
            <button @click="$store.app.mobileOpen = true" class="lg:hidden p-2 text-slate-400">
              <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            
            <div class="hidden md:flex items-center gap-2">
              <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">SİSTEM</span>
              <i data-lucide="chevron-right" class="w-4 h-4 text-slate-300"></i>
              <span class="text-sm font-display font-semibold">{% block breadcrumb %}Genel Bakış{% endblock %}</span>
            </div>
          </div>

          <div class="flex items-center gap-4">
            <div 
              x-data="{ running: false }"
              x-init="
                const checkStatus = async () => {
                  try {
                    const res = await fetch('/api/crawler/status');
                    const data = await res.json();
                    running = data.data?.running;
                  } catch(e) { running = false; }
                };
                checkStatus();
                setInterval(checkStatus, 10000);
              "
              class="flex items-center gap-3 px-4 py-2 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10"
            >
              <div class="relative flex h-2 w-2">
                <span 
                  x-show="running" 
                  class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"
                ></span>
                <span 
                  class="relative inline-flex rounded-full h-2 w-2"
                  :class="running ? 'bg-emerald-500' : 'bg-slate-400'"
                ></span>
              </div>
              <span 
                class="text-[10px] font-bold tracking-tight text-slate-500 dark:text-slate-400 uppercase"
                x-text="running ? 'Tarayıcı Aktif' : 'Tarayıcı Beklemede'"
              ></span>
            </div>

            <button 
              onclick="location.reload()"
              class="p-2 border border-slate-200 dark:border-white/10 hover:bg-brand-accent hover:border-brand-accent hover:text-brand-black transition-all group"
            >
              <i data-lucide="refresh-cw" class="w-5 h-5 group-active:rotate-180 transition-transform duration-500"></i>
            </button>
          </div>
        </header>

        <main class="flex-1 overflow-y-auto p-6 lg:p-10 scroll-smooth">
          <div class="max-w-[1600px] mx-auto">
            {% block content %}{% endblock %}
          </div>
        </main>

        <footer class="h-14 border-t border-slate-200 dark:border-white/5 px-10 flex items-center justify-between text-[10px] font-bold uppercase tracking-widest text-slate-400">
          <div>&copy; 2026 Demir Technical</div>
          <div class="flex items-center gap-4">
            <span class="text-emerald-500">v4.2.0-STABLE</span>
            <span class="w-1 h-1 bg-slate-300 dark:bg-white/20 rounded-full"></span>
            <span>Güvenli Şifreleme</span>
          </div>
        </footer>
      </div>
    </div>

    <div 
      x-show="$store.app.mobileOpen"
      x-cloak
      class="fixed inset-0 z-[100] lg:hidden"
    >
      <div class="absolute inset-0 bg-brand-black/60 backdrop-blur-sm" @click="$store.app.mobileOpen = false"></div>
      <div class="absolute inset-y-0 left-0 w-[80%] bg-brand-black border-r border-white/10 p-6 flex flex-col">
        <div class="flex items-center justify-between mb-10">
          <span class="font-display font-bold text-xl">DEMIR</span>
          <button @click="$store.app.mobileOpen = false"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>
        <nav class="space-y-4">
          <a href="/" class="block py-2 text-lg font-display">Gösterge Paneli</a>
          <a href="/crawler" class="block py-2 text-lg font-display">Tarayıcı</a>
          <a href="/listings" class="block py-2 text-lg font-display">İlanlar</a>
        </nav>
      </div>
    </div>

    {% block scripts %}{% endblock %}
    {% block extra_scripts %}{% endblock %}
    
    <script>
      // Automatically refresh Lucide icons on Alpine changes
      document.addEventListener('alpine:initialized', () => {
        lucide.createIcons();
      });
    </script>
  </body>
</html>
