{% extends "base.html" %} {% block title %}Dashboard{% endblock %} {% block
breadcrumb %}Dashboard{% endblock %} {% block content %}
<div
  x-data="dashboard()"
  x-init="init()"
  x-cloak
  class="space-y-6 animate-fade-in"
>
  <div
    class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
  >
    <div class="animate-slide-up">
      <h1
        class="text-3xl lg:text-4xl font-bold text-slate-900 dark:text-white font-outfit"
      >
        Dashboard
      </h1>
      <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">
        Pazar verilerinin anlık özeti ve crawler kontrolü
      </p>
    </div>

    <div
      class="flex items-center gap-3 animate-slide-up"
      style="animation-delay: 100ms"
    >
      <!-- İLÇE FİLTRESİ - YENİ EKLENEN -->
      <div
        class="flex items-center gap-2 bg-white/50 dark:bg-slate-800/50 backdrop-blur-md rounded-2xl px-4 py-2.5 border border-slate-200/60 dark:border-slate-700/60 shadow-sm transition-premium hover:border-violet-400"
      >
        <svg
          class="w-4 h-4 text-violet-500"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
          ></path>
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
          ></path>
        </svg>
        <select
          x-model="districtFilter"
          @change="loadData()"
          class="bg-transparent text-sm font-semibold text-slate-700 dark:text-slate-300 focus:outline-none cursor-pointer"
        >
          <option value="all">Tüm İlçeler</option>
          {% for district in districts %}
          <option value="{{ district.value }}">
            {{ district.label }} ({{ district.count }})
          </option>
          {% endfor %}
        </select>
      </div>

      <div
        class="flex items-center gap-2 bg-white/50 dark:bg-slate-800/50 backdrop-blur-md rounded-2xl px-4 py-2.5 border border-slate-200/60 dark:border-slate-700/60 shadow-sm transition-premium hover:border-primary-400"
      >
        <svg
          class="w-4 h-4 text-primary-500"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
          ></path>
        </svg>
        <select
          x-model="timeFilter"
          @change="loadData()"
          class="bg-transparent text-sm font-semibold text-slate-700 dark:text-slate-300 focus:outline-none cursor-pointer"
        >
          <option value="1">Son 24 Saat</option>
          <option value="2">Son 2 Gün</option>
          <option value="3">Son 3 Gün</option>
          <option value="7">Son 1 Hafta</option>
        </select>
      </div>

      <button
        @click="loadData()"
        class="p-2.5 bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm hover:bg-primary-50 dark:hover:bg-primary-900/20 text-slate-500 hover:text-primary-600 transition-premium glow-primary"
        :class="loading ? 'animate-spin' : ''"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
          ></path>
        </svg>
      </button>
    </div>
  </div>

  <template x-if="loading">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <template x-for="i in 4" :key="i">
        <div class="h-40 rounded-3xl skeleton"></div>
      </template>
    </div>
  </template>

  <template x-if="!loading">
    <div class="space-y-8">
      <!-- Top Stats Bento Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div
          class="bg-gradient-to-br from-primary-500 to-blue-600 rounded-3xl p-6 text-white shadow-xl shadow-primary-500/20 premium-card group animate-slide-up"
          style="animation-delay: 200ms"
        >
          <div class="flex items-center justify-between">
            <div
              class="w-12 h-12 rounded-2xl bg-white/20 backdrop-blur-md flex items-center justify-center group-hover:scale-110 transition-premium"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
                ></path>
              </svg>
            </div>
            <span
              class="text-xs font-bold bg-white/20 px-3 py-1 rounded-full uppercase tracking-wider"
              >Aktif</span
            >
          </div>
          <div class="mt-6">
            <p
              class="text-4xl font-bold font-outfit"
              x-text="data.total_listings.toLocaleString('tr-TR')"
            >
              0
            </p>
            <p class="text-primary-100 font-medium mt-1">Toplam İlan</p>
          </div>
        </div>

        <div
          class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-3xl p-6 text-white shadow-xl shadow-emerald-500/20 premium-card group animate-slide-up"
          style="animation-delay: 300ms"
        >
          <div class="flex items-center justify-between">
            <div
              class="w-12 h-12 rounded-2xl bg-white/20 backdrop-blur-md flex items-center justify-center group-hover:scale-110 transition-premium"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
            </div>
            <span
              class="text-xs font-bold bg-white/20 px-3 py-1 rounded-full uppercase tracking-wider animate-pulse"
              >Yeni</span
            >
          </div>
          <div class="mt-6">
            <p
              class="text-4xl font-bold font-outfit"
              x-text="data.new_listings.toLocaleString('tr-TR')"
            >
              0
            </p>
            <p class="text-emerald-500-100 font-medium mt-1">
              Yeni İlan
              <span
                class="bg-emerald-400/30 px-1.5 py-0.5 rounded text-[10px]"
                x-text="getTimeLabel()"
              ></span>
            </p>
          </div>
        </div>

        <div
          class="bg-gradient-to-br from-rose-500 to-orange-600 rounded-3xl p-6 text-white shadow-xl shadow-rose-500/20 premium-card group animate-slide-up"
          style="animation-delay: 400ms"
        >
          <div class="flex items-center justify-between">
            <div
              class="w-12 h-12 rounded-2xl bg-white/20 backdrop-blur-md flex items-center justify-center group-hover:scale-110 transition-premium"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                ></path>
              </svg>
            </div>
            <span
              class="text-xs font-bold bg-white/20 px-3 py-1 rounded-full uppercase tracking-wider"
              >Silinen</span
            >
          </div>
          <div class="mt-6">
            <p
              class="text-4xl font-bold font-outfit"
              x-text="data.removed_listings.toLocaleString('tr-TR')"
            >
              0
            </p>
            <p class="text-rose-100 font-medium mt-1">Kaldırılan İlan</p>
          </div>
        </div>

        <div
          class="bg-gradient-to-br from-slate-800 to-slate-950 rounded-3xl p-6 text-white shadow-xl shadow-slate-900/20 premium-card group animate-slide-up border border-slate-700/50"
          style="animation-delay: 500ms"
        >
          <div class="flex items-center justify-between">
            <div
              class="w-12 h-12 rounded-2xl bg-white/10 backdrop-blur-md flex items-center justify-center group-hover:scale-110 transition-premium"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                ></path>
              </svg>
            </div>
            <div
              :class="{
                'bg-emerald-500/20 text-emerald-400': data.last_job?.status === 'completed',
                'bg-amber-500/20 text-amber-400': data.last_job?.status === 'running',
                'bg-rose-500/20 text-rose-400': data.last_job?.status === 'failed',
                'bg-white/10 text-white/60': !data.last_job
              }"
              class="text-[10px] font-black px-2.5 py-1 rounded-lg uppercase tracking-widest"
              x-text="data.last_job?.status || 'Belirsiz'"
            ></div>
          </div>
          <div class="mt-6">
            <p
              class="text-xl font-bold font-outfit truncate"
              x-text="data.last_job?.created_at || 'Bilgi Yok'"
            >
              -
            </p>
            <p class="text-slate-400 font-medium mt-1">Son Güncelleme</p>
          </div>
        </div>
      </div>

      <div
        class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-xl rounded-[2rem] border border-slate-200/50 dark:border-slate-700/50 shadow-sm overflow-hidden animate-slide-up"
        style="animation-delay: 600ms"
      >
        <div
          class="px-8 py-6 border-b border-slate-200/50 dark:border-slate-700/50 flex items-center justify-between"
        >
          <div>
            <h2
              class="text-xl font-bold text-slate-900 dark:text-white font-outfit"
            >
              Kategori Dağılımı
            </h2>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
              Sektörel bazda aktif ve kiralık portföy yoğunluğu
            </p>
          </div>
          <div
            class="px-3 py-1 bg-primary-50 dark:bg-primary-900/20 rounded-full text-[10px] font-bold text-primary-600 uppercase tracking-tighter"
          >
            Canlı Veri
          </div>
        </div>
        <div class="p-8">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <template
              x-for="(counts, category) in data.categories"
              :key="category"
            >
              <div
                class="premium-card bg-slate-50/50 dark:bg-slate-900/30 rounded-3xl p-5 border border-slate-200/50 dark:border-slate-700/50"
              >
                <div
                  x-show="counts.new_satilik > 0 || counts.new_kiralik > 0"
                  class="absolute top-3 right-3 flex gap-1"
                >
                  <span
                    class="flex h-2 w-2 rounded-full bg-rose-500 animate-ping"
                  ></span>
                </div>

                <div class="flex items-center gap-4 mb-5">
                  <div
                    :class="{
                    'bg-amber-100/50 text-amber-600': category === 'konut',
                    'bg-emerald-100/50 text-emerald-600': category === 'arsa',
                    'bg-blue-100/50 text-blue-600': category === 'isyeri',
                    'bg-violet-100/50 text-violet-600': category === 'bina'
                  }"
                    class="w-12 h-12 rounded-2xl flex items-center justify-center text-2xl shadow-inner"
                  >
                    <span x-show="category === 'konut'"
                      ><svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                        ></path></svg
                    ></span>
                    <span x-show="category === 'arsa'"
                      ><svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                        ></path></svg
                    ></span>
                    <span x-show="category === 'isyeri'"
                      ><svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                        ></path></svg
                    ></span>
                    <span x-show="category === 'bina'"
                      ><svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-7v.01M9 21h3m-3 0V13m3 8V10M6 21l6-10 6 10H6z"
                        ></path></svg
                    ></span>
                  </div>
                  <span
                    class="font-bold text-slate-800 dark:text-slate-200 capitalize font-outfit"
                    x-text="getCategoryName(category)"
                  ></span>
                </div>

                <div class="grid grid-cols-2 gap-3">
                  <div
                    class="bg-white dark:bg-slate-800/50 rounded-2xl p-3 border border-slate-100 dark:border-slate-700/50 transition-premium hover:border-primary-400/50 group/item"
                  >
                    <p
                      class="text-[10px] font-bold text-slate-400 uppercase mb-1"
                    >
                      Satılık
                    </p>
                    <div class="flex items-center gap-2">
                      <span
                        class="text-lg font-black text-primary-600 dark:text-primary-400"
                        x-text="counts.satilik"
                      ></span>
                      <span
                        x-show="counts.new_satilik > 0"
                        class="text-[10px] font-bold text-rose-500"
                        x-text="'+' + counts.new_satilik"
                      ></span>
                    </div>
                  </div>
                  <div
                    class="bg-white dark:bg-slate-800/50 rounded-2xl p-3 border border-slate-100 dark:border-slate-700/50 transition-premium hover:border-emerald-400/50 group/item"
                  >
                    <p
                      class="text-[10px] font-bold text-slate-400 uppercase mb-1"
                    >
                      Kiralık
                    </p>
                    <div class="flex items-center gap-2">
                      <span
                        class="text-lg font-black text-emerald-600 dark:text-emerald-400"
                        x-text="counts.kiralik"
                      ></span>
                      <span
                        x-show="counts.new_kiralik > 0"
                        class="text-[10px] font-bold text-rose-500"
                        x-text="'+' + counts.new_kiralik"
                      ></span>
                    </div>
                  </div>
                </div>

                <div
                  class="mt-4 pt-4 border-t border-slate-100 dark:border-slate-700/50 flex justify-between items-center"
                >
                  <span class="text-[10px] font-bold text-slate-400 uppercase"
                    >Toplam</span
                  >
                  <span
                    class="text-sm font-black text-slate-600 dark:text-slate-300"
                    x-text="(counts.satilik + counts.kiralik).toLocaleString('tr-TR')"
                  ></span>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <a
          href="/listings"
          class="premium-card group bg-white/50 dark:bg-slate-800/50 backdrop-blur-md rounded-[2rem] border border-slate-200/60 dark:border-slate-700/60 p-8 shadow-sm animate-slide-up"
          style="animation-delay: 750ms"
        >
          <div class="flex items-center gap-6">
            <div
              class="w-16 h-16 rounded-2xl bg-primary-500 flex items-center justify-center text-white shadow-lg shadow-primary-500/30 group-hover:rotate-6 transition-premium"
            >
              <svg
                class="w-8 h-8"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
                ></path>
              </svg>
            </div>
            <div class="flex-1">
              <h3
                class="text-xl font-bold text-slate-900 dark:text-white font-outfit"
              >
                İlan Arşivi
              </h3>
              <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">
                Gelişmiş filtreleme ve detaylı arama paneli
              </p>
            </div>
            <div
              class="w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-700 flex items-center justify-center group-hover:bg-primary-500 group-hover:text-white transition-premium"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 7l5 5m0 0l-5 5m5-5H6"
                ></path>
              </svg>
            </div>
          </div>
        </a>

        <a
          href="/new-listings"
          class="premium-card group bg-white/50 dark:bg-slate-800/50 backdrop-blur-md rounded-[2rem] border border-slate-200/60 dark:border-slate-700/60 p-8 shadow-sm animate-slide-up"
          style="animation-delay: 850ms"
        >
          <div class="flex items-center gap-6">
            <div
              class="w-16 h-16 rounded-2xl bg-emerald-500 flex items-center justify-center text-white shadow-lg shadow-emerald-500/30 group-hover:rotate-6 transition-premium"
            >
              <svg
                class="w-8 h-8"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                  d="M12 4v16m8-8H4"
                ></path>
              </svg>
            </div>
            <div class="flex-1">
              <h3
                class="text-xl font-bold text-slate-900 dark:text-white font-outfit"
              >
                Radar
              </h3>
              <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">
                Pazara yeni düşen fırsatları anlık takip et
              </p>
            </div>
            <div
              class="w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-700 flex items-center justify-center group-hover:bg-emerald-500 group-hover:text-white transition-premium"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 7l5 5m0 0l-5 5m5-5H6"
                ></path>
              </svg>
            </div>
          </div>
        </a>

        <a
          href="/crawler"
          class="premium-card group bg-white/50 dark:bg-slate-800/50 backdrop-blur-md rounded-[2rem] border border-slate-200/60 dark:border-slate-700/60 p-8 shadow-sm animate-slide-up"
          style="animation-delay: 950ms"
        >
          <div class="flex items-center gap-6">
            <div
              class="w-16 h-16 rounded-2xl bg-orange-500 flex items-center justify-center text-white shadow-lg shadow-orange-500/30 group-hover:rotate-6 transition-premium"
            >
              <svg
                class="w-8 h-8"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                ></path>
              </svg>
            </div>
            <div class="flex-1">
              <h3
                class="text-xl font-bold text-slate-900 dark:text-white font-outfit"
              >
                Kontrol Merkezi
              </h3>
              <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">
                Crawler manuel başlatma ve durum takibi
              </p>
            </div>
            <div
              class="w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-700 flex items-center justify-center group-hover:bg-orange-500 group-hover:text-white transition-premium"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 7l5 5m0 0l-5 5m5-5H6"
                ></path>
              </svg>
            </div>
          </div>
        </a>
      </div>

      <div
        class="bg-white/40 dark:bg-slate-800/40 backdrop-blur-md rounded-[2.5rem] border border-slate-200/50 dark:border-slate-700/50 shadow-sm p-8 animate-slide-up"
        style="animation-delay: 1100ms"
      >
        <h3
          class="text-xl font-bold text-slate-900 dark:text-white mb-8 font-outfit"
        >
          Portföy Trendleri
        </h3>
        <div class="h-80 w-full">
          <canvas id="categoryChart"></canvas>
        </div>
      </div>
    </div>
  </template>
</div>
{% endblock %} {% block scripts %}
<script>
  function dashboard() {
    return {
      loading: true,
      timeFilter: "7",
      districtFilter: "{{ selected_district }}" || "all", // YENİ: İlçe filtresi
      chart: null,
      data: {
        total_listings: 0,
        new_listings: 0,
        removed_listings: 0,
        categories: {},
        last_job: null,
      },

      async init() {
        await this.loadData();
      },

      async loadData() {
        this.loading = true;
        try {
          const response = await fetch(
            `/api/dashboard?days=${this.timeFilter}&district=${this.districtFilter}`, // YENİ: İlçe parametresi eklendi
          );
          const result = await response.json();

          if (result.success) {
            this.data = result.data;
            this.$nextTick(() => this.updateChart());
            if (window.showToast) {
              window.showToast("Veriler güncellendi", "success", 2000);
            }
          }
        } catch (error) {
          console.error("Dashboard yüklenemedi:", error);
          if (window.showToast) {
            window.showToast("Veriler yüklenemedi", "error");
          }
        } finally {
          this.loading = false;
        }
      },

      getCategoryName(category) {
        const names = {
          konut: "Konut",
          arsa: "Arsa",
          isyeri: "İşyeri",
          bina: "Bina",
        };
        return names[category] || category;
      },

      getTimeLabel() {
        const labels = {
          1: "24 saat",
          2: "2 gün",
          3: "3 gün",
          7: "1 hafta",
        };
        return labels[this.timeFilter] || this.timeFilter + " gün";
      },

      updateChart() {
        const ctx = document.getElementById("categoryChart");
        if (!ctx) return;

        const categories = Object.keys(this.data.categories || {});
        const satilikData = categories.map(
          (c) => this.data.categories[c]?.satilik || 0,
        );
        const kiralikData = categories.map(
          (c) => this.data.categories[c]?.kiralik || 0,
        );
        const labels = categories.map((c) => this.getCategoryName(c));

        if (this.chart) {
          this.chart.destroy();
        }

        this.chart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Satılık",
                data: satilikData,
                backgroundColor: "rgba(14, 120, 241, 0.8)",
                hoverBackgroundColor: "rgba(14, 120, 241, 1)",
                borderRadius: 12,
                borderSkipped: false,
                barThickness: 32,
              },
              {
                label: "Kiralık",
                data: kiralikData,
                backgroundColor: "rgba(16, 185, 129, 0.8)",
                hoverBackgroundColor: "rgba(16, 185, 129, 1)",
                borderRadius: 12,
                borderSkipped: false,
                barThickness: 32,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              intersect: false,
              mode: "index",
            },
            plugins: {
              legend: {
                position: "top",
                align: "end",
                labels: {
                  usePointStyle: true,
                  pointStyle: "circle",
                  padding: 25,
                  font: {
                    family: "'Inter', sans-serif",
                    size: 12,
                    weight: "500",
                  },
                  color: document.documentElement.classList.contains("dark")
                    ? "#94a3b8"
                    : "#64748b",
                },
              },
              tooltip: {
                backgroundColor: document.documentElement.classList.contains(
                  "dark",
                )
                  ? "#1e293b"
                  : "#fff",
                titleColor: document.documentElement.classList.contains("dark")
                  ? "#fff"
                  : "#1e293b",
                bodyColor: document.documentElement.classList.contains("dark")
                  ? "#94a3b8"
                  : "#64748b",
                borderColor: "rgba(14, 120, 241, 0.1)",
                borderWidth: 1,
                cornerRadius: 16,
                padding: 16,
                bodyFont: {
                  family: "'Inter', sans-serif",
                },
                titleFont: {
                  family: "'Outfit', sans-serif",
                  size: 14,
                  weight: "600",
                },
                boxPadding: 6,
                usePointStyle: true,
                callbacks: {
                  label: function (context) {
                    return `  ${context.dataset.label}: ${context.parsed.y.toLocaleString("tr-TR")} ilan`;
                  },
                },
              },
            },
            scales: {
              x: {
                grid: {
                  display: false,
                },
                ticks: {
                  font: {
                    family: "'Inter', sans-serif",
                    size: 11,
                  },
                  color: document.documentElement.classList.contains("dark")
                    ? "#64748b"
                    : "#94a3b8",
                },
              },
              y: {
                border: {
                  dash: [4, 4],
                  display: false,
                },
                grid: {
                  color: document.documentElement.classList.contains("dark")
                    ? "rgba(255, 255, 255, 0.05)"
                    : "rgba(0, 0, 0, 0.05)",
                },
                ticks: {
                  font: {
                    family: "'Inter', sans-serif",
                    size: 11,
                  },
                  color: document.documentElement.classList.contains("dark")
                    ? "#64748b"
                    : "#94a3b8",
                  padding: 10,
                  callback: function (value) {
                    return value.toLocaleString("tr-TR");
                  },
                },
              },
            },
          },
        });
      },
    };
  }
</script>
{% endblock %}
