{% extends "base.html" %} {% block title %}İstatistikler{% endblock %} {% block
breadcrumb %}İstatistikler{% endblock %} {% block content %}
<div
  x-data="stats()"
  x-init="init()"
  x-cloak
  class="space-y-8 animate-fade-in pb-12"
>
  <!-- Header -->
  <div
    class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
  >
    <div>
      <h1
        class="text-3xl lg:text-4xl font-bold text-slate-900 dark:text-white font-outfit"
      >
        İstatistikler
      </h1>
      <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">
        Kategori bazlı detaylı analiz ve pazar durumu
      </p>
    </div>

    <button
      @click="loadStats()"
      class="p-2.5 bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm hover:bg-primary-50 dark:hover:bg-primary-900/20 text-slate-500 hover:text-primary-600 transition-premium"
      :class="loading ? 'animate-spin' : ''"
    >
      <svg
        class="w-5 h-5"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
        ></path>
      </svg>
    </button>
  </div>

  <!-- Loading State -->
  <template x-if="loading">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <template x-for="i in 6" :key="i">
        <div class="h-48 rounded-3xl skeleton"></div>
      </template>
    </div>
  </template>

  <!-- Stats Grid -->
  <template x-if="!loading">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <template x-for="stat in stats" :key="stat.category + stat.transaction">
        <div
          class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-xl rounded-3xl p-6 border border-slate-200/50 dark:border-slate-700/50 shadow-sm premium-card"
        >
          <!-- Header -->
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
              <div
                class="w-12 h-12 rounded-2xl bg-primary-50 dark:bg-primary-900/20 flex items-center justify-center text-primary-600 dark:text-primary-400"
              >
                <svg
                  class="w-6 h-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                  ></path>
                </svg>
              </div>
              <div>
                <h3
                  class="font-bold text-slate-900 dark:text-white"
                  x-text="stat.category"
                ></h3>
                <p class="text-xs text-slate-500" x-text="stat.transaction"></p>
              </div>
            </div>

            <!-- Status Badge -->
            <div
              :class="{
                'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400': stat.status === 'synced',
                'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400': stat.status === 'new',
                'bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-400': stat.status === 'removed'
              }"
              class="px-3 py-1 rounded-full text-xs font-bold uppercase"
              x-text="stat.status"
            ></div>
          </div>

          <!-- Stats -->
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <span class="text-sm text-slate-500">Sahibinden</span>
              <span
                class="text-lg font-bold text-slate-900 dark:text-white"
                x-text="stat.sahibinden_count.toLocaleString('tr-TR')"
              ></span>
            </div>

            <div class="flex items-center justify-between">
              <span class="text-sm text-slate-500">Veritabanı</span>
              <span
                class="text-lg font-bold text-primary-600 dark:text-primary-400"
                x-text="stat.database_count.toLocaleString('tr-TR')"
              ></span>
            </div>

            <div class="pt-4 border-t border-slate-200 dark:border-slate-700">
              <div class="flex items-center justify-between">
                <span
                  class="text-sm font-medium text-slate-600 dark:text-slate-400"
                  >Fark</span
                >
                <span
                  :class="{
                    'text-emerald-600': stat.diff === 0,
                    'text-blue-600': stat.diff > 0,
                    'text-rose-600': stat.diff < 0
                  }"
                  class="text-lg font-black"
                  x-text="(stat.diff > 0 ? '+' : '') + stat.diff.toLocaleString('tr-TR')"
                ></span>
              </div>
            </div>

            <!-- Last Checked -->
            <div class="text-xs text-slate-400 text-center">
              Son kontrol: <span x-text="stat.last_checked_at"></span>
            </div>
          </div>
        </div>
      </template>
    </div>
  </template>
</div>
{% endblock %} {% block scripts %}
<script>
  function stats() {
    return {
      loading: true,
      stats: [],

      async init() {
        await this.loadStats();
        // Auto refresh every 30 seconds
        setInterval(() => this.loadStats(), 30000);
      },

      async loadStats() {
        this.loading = true;
        try {
          const response = await fetch("/api/category-stats");
          const result = await response.json();

          if (result.success) {
            this.stats = result.data;
            if (window.showToast) {
              window.showToast("İstatistikler güncellendi", "success", 2000);
            }
          }
        } catch (error) {
          console.error("İstatistikler yüklenemedi:", error);
          if (window.showToast) {
            window.showToast("İstatistikler yüklenemedi", "error");
          }
        } finally {
          this.loading = false;
        }
      },
    };
  }
</script>
{% endblock %}
