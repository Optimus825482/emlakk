version: "3.8"

services:
  # Next.js Application (Standalone)
  nextjs:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        DATABASE_URL: ${DATABASE_URL}
        DIRECT_URL: ${DIRECT_URL}
        AUTH_SECRET: ${AUTH_SECRET}
        NEXT_PUBLIC_APP_URL: ${NEXT_PUBLIC_APP_URL}
        DEEPSEEK_API_KEY: ${DEEPSEEK_API_KEY}
    container_name: demir-nextjs
    restart: always
    ports:
      - "3000:3000"
    environment:
      DATABASE_URL: ${DATABASE_URL}
      DIRECT_URL: ${DIRECT_URL}
      AUTH_SECRET: ${AUTH_SECRET}
      AUTH_TRUST_HOST: "true"
      NEXT_PUBLIC_APP_URL: ${NEXT_PUBLIC_APP_URL}
      DEEPSEEK_API_KEY: ${DEEPSEEK_API_KEY}
      NODE_ENV: production
    extra_hosts:
      - "wgkosgwkg8o4wg4k8cgcw4og:host-gateway"
    volumes:
      # Persist uploaded images across container restarts (bind mount to host)
      - /var/www/uploads:/app/public/uploads

# No named volumes needed - using bind mount directly
